<script>
(function(){
  const MIN_TOPICS = 3;
  const PREFS_KEY = "day_preferences_v1";
  const FLAG_KEY  = "day_onboarding_done_v1";

  function getSelectedTopics(){
    return Array.from(document.querySelectorAll('button.border-2.border-primary span:first-child'))
      .map(el => el.textContent.trim())
      .filter(Boolean);
  }

  function flash(msg){
    let el = document.getElementById("minSelectHint");
    if(!el){
      el = document.createElement("div");
      el.id = "minSelectHint";
      el.className = "mx-5 mt-2 text-sm font-semibold text-primary";
      const p = document.querySelector("main .py-4");
      if(p) p.appendChild(el);
    }
    el.textContent = msg;
    setTimeout(()=>{ el.textContent = ""; }, 1600);
  }

  // Toggle SOLO Themes (los botones del grid)
  document.querySelectorAll('.grid button').forEach(btn=>{
    const label = btn.querySelector("span");
    const icon = btn.querySelector(".material-symbols-outlined");
    if(!label || !icon) return;

    btn.addEventListener("click", (e)=>{
      e.preventDefault();
      const selected = btn.classList.contains("bg-primary/10");

      if(selected){
        btn.classList.remove("bg-primary/10","border-2","border-primary");
        btn.classList.add("bg-surface-light","dark:bg-surface-dark","border","border-transparent");
        label.classList.remove("text-primary","font-bold");
        label.classList.add("text-neutral-dark","dark:text-white","font-semibold");
        icon.textContent = "add";
        icon.classList.remove("text-primary","font-bold");
        icon.classList.add("text-neutral-muted/40","dark:text-white/20");
      } else {
        btn.classList.add("bg-primary/10","border-2","border-primary");
        btn.classList.remove("bg-surface-light","dark:bg-surface-dark","border","border-transparent");
        label.classList.add("text-primary","font-bold");
        label.classList.remove("text-neutral-dark","dark:text-white","font-semibold");
        icon.textContent = "check";
        icon.classList.add("text-primary","font-bold");
        icon.classList.remove("text-neutral-muted/40","dark:text-white/20");
      }
    });
  });

  function finishOnboarding(){
    const topics = getSelectedTopics();

    if(topics.length < MIN_TOPICS){
      flash("Pick at least 3 topics ✨");
      return;
    }

    localStorage.setItem(PREFS_KEY, JSON.stringify({
      topics,
      savedAt: new Date().toISOString()
    }));

    // ✅ EL ÚNICO FLAG que importa
    localStorage.setItem(FLAG_KEY, "1");

    // ir a la app principal
    window.location.replace("../index.html");
  }

  // ✅ IMPORTANTÍSIMO: tu botón Skip debe tener id="skipBtn"
  const skipBtn = document.getElementById("skipBtn");
  if(skipBtn){
    skipBtn.addEventListener("click", ()=>{
      localStorage.setItem(FLAG_KEY, "1");
      window.location.replace("../index.html");
    });
  }

  const startBtn = document.getElementById("startReadingBtn");
  if(startBtn){
    startBtn.addEventListener("click", finishOnboarding);
  }
})();
</script>
